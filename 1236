#include <opencv2/opencv.hpp>

int main() {
    cv::Mat img = cv::imread("test_image.jpg");
    cv::Mat hsv;
    cv::cvtColor(img, hsv, cv::COLOR_BGR2HSV);

    // Выделяем только канал H
    std::vector<cv::Mat> channels;
    cv::split(hsv, channels);

    int histSize = 180; // Для Hue в OpenCV диапазон 0-179
    float range[] = { 0, 180 };
    const float* histRange = { range };
    cv::Mat hist;

    cv::calcHist(&channels[0], 1, 0, cv::Mat(), hist, 1, &histSize, &histRange);

    // Визуализация
    int hist_w = 540, hist_h = 400;
    int bin_w = cvRound((double)hist_w / histSize);
    cv::Mat histImage(hist_h, hist_w, CV_8UC3, cv::Scalar(0,0,0));

    cv::normalize(hist, hist, 0, histImage.rows, cv::NORM_MINMAX);

    for (int i = 1; i < histSize; i++) {
        cv::line(histImage, 
                 cv::Point(bin_w*(i-1), hist_h - cvRound(hist.at<float>(i-1))),
                 cv::Point(bin_w*(i), hist_h - cvRound(hist.at<float>(i))),
                 cv::Scalar(255, 255, 255), 2);
    }

    cv::imshow("Hue Histogram", histImage);
    cv::waitKey(0);
    return 0;
}
